{"code":"import * as tslib_1 from \"tslib\";\r\nimport keyframes from '../keyframes';\r\nimport { easeInOut, linear } from '../../easing';\r\nimport composite from '../../compositors/composite';\r\nvar DEFAULT_DURATION = 300;\r\nvar flattenTimings = function (instructions) {\r\n    var flatInstructions = [];\r\n    var lastArg = instructions[instructions.length - 1];\r\n    var isStaggered = typeof lastArg === 'number';\r\n    var staggerDelay = isStaggered ? lastArg : 0;\r\n    var segments = isStaggered ? instructions.slice(0, -1) : instructions;\r\n    var numSegments = segments.length;\r\n    var offset = 0;\r\n    segments.forEach(function (item, i) {\r\n        flatInstructions.push(item);\r\n        if (i !== numSegments - 1) {\r\n            var duration = item.duration || DEFAULT_DURATION;\r\n            offset += staggerDelay;\r\n            flatInstructions.push(\"-\" + (duration - offset));\r\n        }\r\n    });\r\n    return flatInstructions;\r\n};\r\nvar flattenArrayInstructions = function (instructions, instruction) {\r\n    Array.isArray(instruction)\r\n        ? instructions.push.apply(instructions, flattenTimings(instruction)) : instructions.push(instruction);\r\n    return instructions;\r\n};\r\nvar convertDefToProps = function (props, def, i) {\r\n    var duration = props.duration, easings = props.easings, times = props.times, values = props.values;\r\n    var numValues = values.length;\r\n    var prevTimeTo = times[numValues - 1];\r\n    var timeFrom = def.at === 0 ? 0 : def.at / duration;\r\n    var timeTo = (def.at + def.duration) / duration;\r\n    if (i === 0) {\r\n        values.push(def.from);\r\n        times.push(timeFrom);\r\n    }\r\n    else {\r\n        if (prevTimeTo !== timeFrom) {\r\n            if (def.from !== undefined) {\r\n                values.push(values[numValues - 1]);\r\n                times.push(timeFrom);\r\n                easings.push(linear);\r\n            }\r\n            var from = def.from !== undefined ? def.from : values[numValues - 1];\r\n            values.push(from);\r\n            times.push(timeFrom);\r\n            easings.push(linear);\r\n        }\r\n        else if (def.from !== undefined) {\r\n            values.push(def.from);\r\n            times.push(timeFrom);\r\n            easings.push(linear);\r\n        }\r\n    }\r\n    values.push(def.to);\r\n    times.push(timeTo);\r\n    easings.push(def.ease || easeInOut);\r\n    return props;\r\n};\r\nvar timeline = function (instructions, _a) {\r\n    var _b = _a === void 0 ? {} : _a, duration = _b.duration, elapsed = _b.elapsed, ease = _b.ease, loop = _b.loop, flip = _b.flip, yoyo = _b.yoyo;\r\n    var playhead = 0;\r\n    var calculatedDuration = 0;\r\n    var flatInstructions = instructions.reduce(flattenArrayInstructions, []);\r\n    var animationDefs = [];\r\n    flatInstructions.forEach(function (instruction) {\r\n        if (typeof instruction === 'string') {\r\n            playhead += parseFloat(instruction);\r\n        }\r\n        else if (typeof instruction === 'number') {\r\n            playhead = instruction;\r\n        }\r\n        else {\r\n            var def = tslib_1.__assign({}, instruction, { at: playhead });\r\n            def.duration = def.duration === undefined ? DEFAULT_DURATION : def.duration;\r\n            animationDefs.push(def);\r\n            playhead += def.duration;\r\n            calculatedDuration = Math.max(calculatedDuration, def.at + def.duration);\r\n        }\r\n    });\r\n    var tracks = {};\r\n    var numDefs = animationDefs.length;\r\n    for (var i = 0; i < numDefs; i++) {\r\n        var def = animationDefs[i];\r\n        var track = def.track;\r\n        if (track === undefined) {\r\n            throw new Error('No track defined');\r\n        }\r\n        if (!tracks.hasOwnProperty(track))\r\n            tracks[track] = [];\r\n        tracks[track].push(def);\r\n    }\r\n    var trackKeyframes = {};\r\n    for (var key in tracks) {\r\n        if (tracks.hasOwnProperty(key)) {\r\n            var keyframeProps = tracks[key].reduce(convertDefToProps, {\r\n                duration: calculatedDuration,\r\n                easings: [],\r\n                times: [],\r\n                values: []\r\n            });\r\n            trackKeyframes[key] = keyframes(tslib_1.__assign({}, keyframeProps, { duration: duration || calculatedDuration, ease: ease,\r\n                elapsed: elapsed,\r\n                loop: loop,\r\n                yoyo: yoyo,\r\n                flip: flip }));\r\n        }\r\n    }\r\n    return composite(trackKeyframes);\r\n};\r\nexport default timeline;\r\n//# sourceMappingURL=index.js.map","map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/animations/timeline/index.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/mattperry/Sites/popmotion/packages/popmotion/animations/timeline/index.d.ts","text":"import { Action } from '../../action';\r\nimport { Instruction } from './types';\r\nimport { TweenProps } from '../tween/types';\r\ndeclare const timeline: (instructions: Instruction[], { duration, elapsed, ease, loop, flip, yoyo }?: TweenProps) => Action;\r\nexport default timeline;\r\n"}}
