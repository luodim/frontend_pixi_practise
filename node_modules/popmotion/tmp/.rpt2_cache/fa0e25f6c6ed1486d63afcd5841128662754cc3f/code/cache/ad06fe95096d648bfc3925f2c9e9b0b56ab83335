{"code":"import * as tslib_1 from \"tslib\";\r\nimport { timeSinceLastFrame, currentFrameTime, onFrameEnd } from 'framesync';\r\nimport { speedPerSecond } from '../calc';\r\nimport { BaseMulticast } from './';\r\nvar isValueList = function (v) { return Array.isArray(v); };\r\nvar isSingleValue = function (v) {\r\n    var typeOfV = typeof v;\r\n    return (typeOfV === 'string' || typeOfV === 'number');\r\n};\r\nvar ValueReaction = (function (_super) {\r\n    tslib_1.__extends(ValueReaction, _super);\r\n    function ValueReaction(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.scheduleVelocityCheck = function () { return onFrameEnd(_this.velocityCheck); };\r\n        _this.velocityCheck = function () {\r\n            if (currentFrameTime() !== _this.lastUpdated) {\r\n                _this.prev = _this.current;\r\n            }\r\n        };\r\n        _this.prev = _this.current = props.value || 0;\r\n        if (isSingleValue(_this.current)) {\r\n            _this.updateCurrent = function (v) { return _this.current = v; };\r\n            _this.getVelocityOfCurrent = function () { return _this.getSingleVelocity(_this.current, _this.prev); };\r\n        }\r\n        else if (isValueList(_this.current)) {\r\n            _this.updateCurrent = function (v) { return _this.current = v.slice(); };\r\n            _this.getVelocityOfCurrent = function () { return _this.getListVelocity(); };\r\n        }\r\n        else {\r\n            _this.updateCurrent = function (v) {\r\n                _this.current = {};\r\n                for (var key in v) {\r\n                    if (v.hasOwnProperty(key)) {\r\n                        _this.current[key] = v[key];\r\n                    }\r\n                }\r\n            };\r\n            _this.getVelocityOfCurrent = function () { return _this.getMapVelocity(); };\r\n        }\r\n        if (props.initialSubscription)\r\n            _this.subscribe(props.initialSubscription);\r\n        return _this;\r\n    }\r\n    ValueReaction.prototype.create = function (props) {\r\n        return new ValueReaction(props);\r\n    };\r\n    ValueReaction.prototype.get = function () {\r\n        return this.current;\r\n    };\r\n    ValueReaction.prototype.getVelocity = function () {\r\n        return this.getVelocityOfCurrent();\r\n    };\r\n    ValueReaction.prototype.update = function (v) {\r\n        _super.prototype.update.call(this, v);\r\n        this.prev = this.current;\r\n        this.updateCurrent(v);\r\n        this.timeDelta = timeSinceLastFrame();\r\n        this.lastUpdated = currentFrameTime();\r\n        onFrameEnd(this.scheduleVelocityCheck);\r\n    };\r\n    ValueReaction.prototype.subscribe = function (observerCandidate) {\r\n        var sub = _super.prototype.subscribe.call(this, observerCandidate);\r\n        this.update(this.current);\r\n        return sub;\r\n    };\r\n    ValueReaction.prototype.getSingleVelocity = function (current, prev) {\r\n        return (typeof current === 'number' && typeof prev === 'number')\r\n            ? speedPerSecond(current - prev, this.timeDelta)\r\n            : speedPerSecond(parseFloat(current) - parseFloat(prev), this.timeDelta) || 0;\r\n    };\r\n    ValueReaction.prototype.getListVelocity = function () {\r\n        var _this = this;\r\n        return this.current.map(function (c, i) { return _this.getSingleVelocity(c, _this.prev[i]); });\r\n    };\r\n    ValueReaction.prototype.getMapVelocity = function () {\r\n        var velocity = {};\r\n        for (var key in this.current) {\r\n            if (this.current.hasOwnProperty(key)) {\r\n                velocity[key] = this.getSingleVelocity(this.current[key], this.prev[key]);\r\n            }\r\n        }\r\n        return velocity;\r\n    };\r\n    return ValueReaction;\r\n}(BaseMulticast));\r\nexport { ValueReaction };\r\nexport default (function (value, initialSubscription) { return new ValueReaction({ value: value, initialSubscription: initialSubscription }); });\r\n//# sourceMappingURL=value.js.map","map":"{\"version\":3,\"file\":\"value.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/reactions/value.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EAAE,kBAAkB,EAAE,gBAAgB,EAAE,UAAU,EAAE,MAAM,WAAW,CAAC;AAC7E,OAAO,EAAE,cAAc,EAAE,MAAM,SAAS,CAAC;AAEzC,OAAO,EAAE,aAAa,EAAE,MAAM,IAAI,CAAC;AAYnC,IAAM,WAAW,GAAG,UAAC,CAAM,IAAqB,OAAA,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,EAAhB,CAAgB,CAAC;AACjE,IAAM,aAAa,GAAG,UAAC,CAAM;IAC3B,IAAM,OAAO,GAAG,OAAO,CAAC,CAAC;IACzB,OAAO,CAAC,OAAO,KAAK,QAAQ,IAAI,OAAO,KAAK,QAAQ,CAAC,CAAC;AACxD,CAAC,CAAC;AAEF;IAAmC,yCAA4B;IAS7D,uBAAY,KAAiB;QAA7B,YACE,kBAAM,KAAK,CAAC,SA0Bb;QAuBD,2BAAqB,GAAG,cAAM,OAAA,UAAU,CAAC,KAAI,CAAC,aAAa,CAAC,EAA9B,CAA8B,CAAC;QAE7D,mBAAa,GAAG;YACd,IAAI,gBAAgB,EAAE,KAAK,KAAI,CAAC,WAAW,EAAE;gBAC3C,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,OAAO,CAAC;aAC1B;QACH,CAAC,CAAA;QAtDC,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC,KAAK,IAAI,CAAC,CAAC;QAE5C,IAAI,aAAa,CAAC,KAAI,CAAC,OAAO,CAAC,EAAE;YAC/B,KAAI,CAAC,aAAa,GAAG,UAAC,CAAkB,IAAK,OAAA,KAAI,CAAC,OAAO,GAAG,CAAC,EAAhB,CAAgB,CAAC;YAC9D,KAAI,CAAC,oBAAoB,GAAG,cAAM,OAAA,KAAI,CAAC,iBAAiB,CACtD,KAAI,CAAC,OAA0B,EAAE,KAAI,CAAC,IAAuB,CAC9D,EAFiC,CAEjC,CAAC;SAEH;aAAM,IAAI,WAAW,CAAC,KAAI,CAAC,OAAO,CAAC,EAAE;YACpC,KAAI,CAAC,aAAa,GAAG,UAAC,CAAY,IAAK,OAAA,KAAI,CAAC,OAAO,GAAO,CAAC,QAAC,EAArB,CAAqB,CAAC;YAC7D,KAAI,CAAC,oBAAoB,GAAG,cAAM,OAAA,KAAI,CAAC,eAAe,EAAE,EAAtB,CAAsB,CAAC;SAE1D;aAAM;YACL,KAAI,CAAC,aAAa,GAAG,UAAC,CAAW;gBAC/B,KAAI,CAAC,OAAO,GAAG,EAAE,CAAC;gBAClB,KAAK,IAAM,GAAG,IAAI,CAAC,EAAE;oBACnB,IAAI,CAAC,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;wBACzB,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;qBAC5B;iBACF;YACH,CAAC,CAAC;YACF,KAAI,CAAC,oBAAoB,GAAG,cAAM,OAAA,KAAI,CAAC,cAAc,EAAE,EAArB,CAAqB,CAAC;SACzD;QAED,IAAI,KAAK,CAAC,mBAAmB;YAAE,KAAI,CAAC,SAAS,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;;IAC3E,CAAC;IAED,8BAAM,GAAN,UAAO,KAAiB;QACtB,OAAO,IAAI,aAAa,CAAC,KAAK,CAAC,CAAC;IAClC,CAAC;IAED,2BAAG,GAAH;QACE,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,mCAAW,GAAX;QACE,OAAO,IAAI,CAAC,oBAAoB,EAAE,CAAC;IACrC,CAAC;IAED,8BAAM,GAAN,UAAO,CAAQ;QACb,iBAAM,MAAM,YAAC,CAAC,CAAC,CAAC;QAChB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;QACzB,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QACtB,IAAI,CAAC,SAAS,GAAG,kBAAkB,EAAE,CAAC;QACtC,IAAI,CAAC,WAAW,GAAG,gBAAgB,EAAE,CAAC;QACtC,UAAU,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;IACzC,CAAC;IAUD,iCAAS,GAAT,UAAU,iBAAoC;QAC5C,IAAM,GAAG,GAAG,iBAAM,SAAS,YAAC,iBAAiB,CAAC,CAAC;QAC/C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAE1B,OAAO,GAAG,CAAC;IACb,CAAC;IAEO,yCAAiB,GAAzB,UAA0B,OAAwB,EAAE,IAAqB;QACvE,OAAO,CAAC,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,IAAI,KAAK,QAAQ,CAAC;YAC9D,CAAC,CAAC,cAAc,CAAC,OAAO,GAAG,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;YAChD,CAAC,CAAC,cAAc,CAAC,UAAU,CAAC,OAAiB,CAAC,GAAG,UAAU,CAAC,IAAc,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IACtG,CAAC;IAEO,uCAAe,GAAvB;QAAA,iBAIC;QAHC,OAAQ,IAAI,CAAC,OAAqB,CAAC,GAAG,CACpC,UAAC,CAAkB,EAAE,CAAS,IAAK,OAAA,KAAI,CAAC,iBAAiB,CAAC,CAAC,EAAG,KAAI,CAAC,IAAkB,CAAC,CAAC,CAAC,CAAC,EAAtD,CAAsD,CAC1F,CAAC;IACJ,CAAC;IAEO,sCAAc,GAAtB;QACE,IAAM,QAAQ,GAAa,EAAE,CAAC;QAC9B,KAAK,IAAM,GAAG,IAAI,IAAI,CAAC,OAAmB,EAAE;YAC1C,IAAI,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;gBACpC,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,iBAAiB,CACnC,IAAI,CAAC,OAAoB,CAAC,GAAG,CAAC,EAAG,IAAI,CAAC,IAAiB,CAAC,GAAG,CAAC,CAC9D,CAAC;aACH;SACF;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;IACH,oBAAC;AAAD,CAAC,AAjGD,CAAmC,aAAa,GAiG/C;;AAED,gBAAe,UAAC,KAAY,EAAE,mBAA4B,IAAK,OAAA,IAAI,aAAa,CAAC,EAAE,KAAK,OAAA,EAAE,mBAAmB,qBAAA,EAAE,CAAC,EAAjD,CAAiD,EAAC\"}"}
